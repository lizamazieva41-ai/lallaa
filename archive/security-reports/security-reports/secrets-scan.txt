src/controllers/auth.ts:const refreshTokenSchema = Joi.object({
src/controllers/auth.ts:const changePasswordSchema = Joi.object({
src/controllers/auth.ts:const resetPasswordSchema = Joi.object({
src/controllers/auth.ts:    const { email, password, firstName, lastName } = req.body;
src/controllers/auth.ts:    const { email, password } = req.body;
src/controllers/auth.ts:export const refreshToken = asyncHandler(
src/controllers/auth.ts:    const refreshToken = req.body.refreshToken || req.cookies.refreshToken;
src/controllers/auth.ts:    const tokens = await authService.refreshToken(refreshToken);
src/controllers/auth.ts:export const changePassword = asyncHandler(
src/controllers/auth.ts:    const { currentPassword, newPassword } = req.body;
src/controllers/auth.ts:export const requestPasswordReset = asyncHandler(
src/controllers/auth.ts:export const resetPassword = asyncHandler(
src/controllers/auth.ts:    const { token, newPassword } = req.body;
src/controllers/auth.ts:    const { token } = req.body;
src/controllers/auth.ts:    const { password } = req.body;
src/controllers/auth.ts:    const { password } = req.body;
src/middleware/rls.ts:  const serviceToken = req.headers['x-service-token'] as string;
src/middleware/rls.ts:  const validTokens = process.env.SERVICE_TOKENS?.split(',') || [];
src/middleware/auth-enhanced.ts:export const authenticateToken = async (
src/middleware/auth-enhanced.ts:    const token = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN
src/middleware/auth-enhanced.ts:      'UPDATE api_keys SET last_used_at = CURRENT_TIMESTAMP WHERE id = $1',
src/middleware/auth.ts:    const token = authHeader.split(' ')[1];
src/scripts/test-rls-simple.ts:      const ownAPIKey = await this.pool.query('SELECT key_id, name FROM api_keys WHERE user_id = $1', [testUserId]);
src/scripts/test-rls-simple.ts:      const otherAPIKeys = await this.pool.query('SELECT key_id FROM api_keys WHERE user_id != $1 LIMIT 1', [testUserId]);
src/services/twoFactor.ts:    const secret = this.generateSecret();
src/services/twoFactor.ts:    const isValidPassword = await userModel.validatePassword(user, password);
src/services/twoFactor.ts:    const isValidPassword = await userModel.validatePassword(user, password);
src/services/auth.ts:    const payload: Omit<TokenPayload, 'type'> = {
src/services/auth.ts:    const payload: Omit<TokenPayload, 'type'> = {
src/services/auth.ts:    const accessToken = this.generateAccessToken(user);
src/services/auth.ts:    const refreshToken = this.generateRefreshToken(user);
src/services/auth.ts:    const tokens = this.generateTokens(user);
src/services/auth.ts:    const tokens = this.generateTokens(user);
src/services/auth.ts:    const newPasswordHash = await bcrypt.hash(
src/services/auth.ts:      const { token, reset } = await passwordResetModel.create(user.id);
src/services/auth.ts:    const newPasswordHash = await bcrypt.hash(
src/services/auth.ts:    const resetUrl = `${config.app.frontendUrl || 'http://localhost:3000'}/reset-password?token=${token}`;
src/services/auth.ts:      token: config.app.env === 'development' ? token : '[REDACTED]'
src/services/auth.ts:    const { passwordHash, twoFactorSecret, ...sanitized } = user;
src/models/passwordReset.ts:const mapRowToPasswordReset = (row: PasswordResetRow, token?: string): PasswordReset => ({
src/models/passwordReset.ts:  private readonly TOKEN_EXPIRY_HOURS = 1; // 1 hour expiry
src/models/passwordReset.ts:    const token = crypto.randomBytes(32).toString('hex');
src/models/passwordReset.ts:    const tokenHash = crypto.createHash('sha256').update(token).digest('hex');
src/models/passwordReset.ts:      const result: QueryResult<PasswordResetRow> = await database.query(query, [
src/models/passwordReset.ts:    const tokenHash = crypto.createHash('sha256').update(token).digest('hex');
src/models/passwordReset.ts:      WHERE token_hash = $1 AND used_at IS NULL AND expires_at > CURRENT_TIMESTAMP
src/models/passwordReset.ts:      const result: QueryResult<PasswordResetRow> = await database.query(query, [tokenHash]);
src/models/passwordReset.ts:export const passwordResetModel = new PasswordResetModel();
src/models/user.ts:    const passwordHash = await bcrypt.hash(
src/models/user.ts:      SET password_hash = $1, updated_at = CURRENT_TIMESTAMP
src/models/user.ts:      SET two_factor_secret = $1, backup_codes = $2, updated_at = CURRENT_TIMESTAMP
src/models/user.ts:      SET two_factor_enabled = false, two_factor_secret = NULL, backup_codes = NULL, updated_at = CURRENT_TIMESTAMP
src/database/security/rls-policies.sql:           (SELECT COUNT(*) > 0 FROM api_keys WHERE user_id = test_user_id),
